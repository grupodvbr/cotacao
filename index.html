<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Comparador de Pre√ßos ‚Ä¢ Grupo DV</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Inter', sans-serif;
  background: #f9fafb;
  margin: 0; padding: 20px;
}
h1 {
  text-align: center;
  color: #222;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
  font-size: 14px;
}
th { background: #222; color: #fff; }
tr:nth-child(even) { background: #f1f1f1; }
tr:hover { background: #e9e9e9; cursor: pointer; }
tr.menor { background: #c6f6d5; font-weight: 600; }
.loader { text-align: center; margin-top: 50px; }

/* ===== MODAL ===== */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.5);
  justify-content: center; align-items: center;
  z-index: 100;
}
.modal-content {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 750px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.3);
  overflow-y: auto;
  max-height: 85vh;
}
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}
.close-btn {
  background: #ff5555;
  color: #fff;
  border: none;
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}
.close-btn:hover { background: #ff3333; }
</style>
</head>
<body>

<h1>üí∞ Comparador de Pre√ßos por Fornecedor</h1>
<div id="tabela"></div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalTitulo"></h2>
      <button class="close-btn" onclick="fecharModal()">Fechar</button>
    </div>
    <div id="modalConteudo"></div>
  </div>
</div>

<script>
// =============================
// üîó CONFIGURA√á√ÉO DO ENDPOINT
// =============================
const ENDPOINT = "https://script.google.com/macros/s/AKfycbxheJUgFnkX3KruV3WZnTkNv8Fs4KHpDnU-K7kiekjlFW2kUjn3eLvqaMObromom3s1GA/exec?action=comparar";

// =============================
// üîÑ CARREGA OS DADOS DO GAS
// =============================
async function carregar() {
  const div = document.getElementById('tabela');
  div.innerHTML = '<div class="loader">‚è≥ Carregando dados...</div>';

  try {
    const res = await fetch(ENDPOINT);
    const data = await res.json();

    if (!Array.isArray(data) || data.length === 0) {
      div.innerHTML = '<p>Nenhum dado retornado.</p>';
      return;
    }

    let html = `<table>
      <thead>
        <tr>
          <th>Produto (3 primeiras palavras)</th>
          <th>Unidade</th>
          <th>Quantidade</th>
          <th>Fornecedor Mais Barato</th>
          <th>Valor Unit√°rio</th>
        </tr>
      </thead>
      <tbody>`;

    data.forEach((item, i) => {
      html += `<tr class="${item.fornecedor_mais_barato !== 'N/D' ? 'menor' : ''}" onclick="abrirModal(${i})">
        <td>${item.produto}</td>
        <td>${item.unidade || '-'}</td>
        <td>${item.quantidade || 0}</td>
        <td>${item.fornecedor_mais_barato}</td>
        <td>R$ ${(item.valor_unitario || 0).toFixed(2)}</td>
      </tr>`;
    });

    html += '</tbody></table>';
    div.innerHTML = html;

    // Guarda os dados globalmente
    window.todosDados = data;

  } catch (err) {
    div.innerHTML = `<p>Erro ao carregar: ${err.message}</p>`;
  }
}

// =============================
// üì¶ MODAL DETALHADO POR ITEM
// =============================
function abrirModal(index) {
  const item = window.todosDados[index];
  const modal = document.getElementById('modal');
  const conteudo = document.getElementById('modalConteudo');
  document.getElementById('modalTitulo').textContent = item.produto.toUpperCase();

  if (!item.fornecedores || item.fornecedores.length === 0) {
    conteudo.innerHTML = `<p>Nenhum fornecedor encontrado para esse item.</p>`;
  } else {
    let tabela = `<table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr style="background:#222; color:#fff;">
          <th style="padding:6px;">Fornecedor</th>
          <th style="padding:6px;">Descri√ß√£o</th>
          <th style="padding:6px;">Valor Unit√°rio</th>
          <th style="padding:6px;">Valor Total</th>
        </tr>
      </thead>
      <tbody>`;

    item.fornecedores.forEach(f => {
      const destaque = f.fornecedor === item.fornecedor_mais_barato;
      tabela += `<tr style="background:${destaque ? '#c6f6d5' : 'transparent'}; font-weight:${destaque ? '600' : '400'};">
        <td style="padding:6px;">${f.fornecedor}</td>
        <td style="padding:6px;">${f.descricaoItem}</td>
        <td style="padding:6px;">R$ ${(f.valorUnit || 0).toFixed(2)}</td>
        <td style="padding:6px;">R$ ${(f.valorTotal || 0).toFixed(2)}</td>
      </tr>`;
    });

    tabela += '</tbody></table>';
    conteudo.innerHTML = tabela;
  }

  modal.style.display = 'flex';
}

function fecharModal() {
  document.getElementById('modal').style.display = 'none';
}

// =============================
// üöÄ INICIALIZA√á√ÉO
// =============================
carregar();
</script>

</body>
</html>
