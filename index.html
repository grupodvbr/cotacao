<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SISTEMA DE LICITA√á√ïES</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}

/* ===========================
   LOGIN MODERNO
=========================== */
#loginPage{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:#0a0f15;display:flex;align-items:center;
  justify-content:center;flex-direction:column;color:white;
  z-index:9999;
}
#loginBox{
  background:#111822;
  padding:40px;
  width:90%;max-width:380px;
  border-radius:18px;
  box-shadow:0 0 25px rgba(0,0,0,0.4);
  text-align:center;
}
#loginBox h1{
  margin-bottom:25px;font-size:28px;letter-spacing:2px;
}
.campo{
  width:100%;padding:12px;margin-bottom:15px;
  border:none;border-radius:8px;font-size:15px;
}
#btnLogin{
  width:100%;padding:12px;
  background:#1a73e8;border:none;color:white;
  border-radius:8px;font-weight:600;cursor:pointer;
}
#btnLogin:hover{background:#135ec7;}
#loginErro{color:#ff6b6b;margin-top:10px;height:20px;}

/* ===========================
   PAINEL NORMAL (AP√ìS LOGIN)
=========================== */
body{background:#f2f4f8;padding:20px;}
h1{text-align:center;margin-bottom:20px;}
button{
  padding:10px 18px;border:none;border-radius:8px;
  cursor:pointer;font-weight:600;
}
#btnDocs{
  background:#222;color:white;margin:0 auto 20px;display:block;
}

/* MODAL DOCUMENTOS */
.modal{
  display:none;position:fixed;top:0;left:0;
  width:100%;height:100%;background:rgba(0,0,0,0.6);
  justify-content:center;align-items:center;z-index:5000;
}
.modal-content{
  background:white;padding:20px;border-radius:12px;
  width:90%;max-width:850px;max-height:80vh;overflow-y:auto;
}
.close-btn{
  background:#d9534f;color:white;padding:8px 14px;border:none;
  border-radius:8px;font-weight:700;cursor:pointer;
}
.folder{margin:15px 0;font-weight:600;}
.file,.subfile{margin-left:25px;margin-bottom:6px;}
a{text-decoration:none;color:#1a73e8;}
</style>
</head>

<body>

<!-- =======================
     LOGIN PAGE
======================= -->
<div id="loginPage">
  <div id="loginBox">
    <h1>LICITAR</h1>

    <input type="text" id="user" class="campo" placeholder="Usu√°rio">
    <input type="password" id="pass" class="campo" placeholder="Senha">

    <button id="btnLogin" onclick="fazerLogin()">Entrar</button>

    <div id="loginErro"></div>
  </div>
</div>

<!-- =======================
     PAINEL
======================= -->
<h1>SISTEMA DE LICITA√á√ïES</h1>

<button id="btnDocs" onclick="abrirDocumentos()">üìÅ DOCUMENTOS</button>

<div id="tabela">
  <p style="text-align:center;color:#777;">Painel carregado. Escolha DOCUMENTOS.</p>
</div>

<!-- =======================
    MODAL DOCUMENTOS
======================= -->
<div class="modal" id="modalDocs">
  <div class="modal-content">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h2 id="tituloDocs">DOCUMENTOS</h2>
      <button class="close-btn" onclick="fecharModal()">Fechar</button>
    </div>
    <div id="conteudoDocs"></div>
  </div>
</div>

<script>
/* ============================================
   VARI√ÅVEIS DO SISTEMA
============================================ */
const API = "https://script.google.com/macros/s/AKfycbzqG0pLLdYrDPKhXxVvqhaxPFDc1U_nQgYXyN1m2FLctzBEwHd2PwIJ9bX9jVmGB-GRWg/exec";

const usuariosTeste = {
  admin: "1234",
  joao: "1111",
  ana: "2222"
};

/* ============================================
   LOGIN
============================================ */
function fazerLogin(){
  const u = document.getElementById("user").value.trim().toLowerCase();
  const p = document.getElementById("pass").value.trim();

  if(usuariosTeste[u] && usuariosTeste[u] === p){
    localStorage.setItem("usuarioLogado", u);

    registrarAcao("LOGIN", "-", "-", "Painel");

    document.getElementById("loginPage").style.display = "none";
  } else {
    document.getElementById("loginErro").innerText = "Usu√°rio ou senha incorretos.";
  }
}

/* Impede entrar sem login */
window.onload = () => {
  if(localStorage.getItem("usuarioLogado")){
    document.getElementById("loginPage").style.display = "none";
  }
};

/* ============================================
   REGISTRAR A√á√ïES NO GAS
============================================ */
function registrarAcao(acao, arquivo, id, pasta){
  fetch(API, {
    method: "POST",
    body: JSON.stringify({
      usuario: localStorage.getItem("usuarioLogado"),
      acao: acao,
      arquivo: arquivo,
      id: id,
      pasta: pasta,
      origem: "Painel"
    })
  });
}

/* ============================================
   DOCUMENTOS ‚Äì LISTAR PASTAS E ARQUIVOS
============================================ */
async function abrirDocumentos(){
  registrarAcao("ABRIU GERENCIADOR DE DOCUMENTOS", "-", "-", "DOCUMENTOS");

  document.getElementById("modalDocs").style.display = "flex";
  document.getElementById("conteudoDocs").innerHTML = `<p>Carregando documentos...</p>`;

  const res = await fetch(API + "?action=listarDrive");
  const dados = await res.json();

  let html = "";

  dados.forEach(p =>{
    html += `<div class="folder">üìÅ <strong>${p.nome}</strong></div>`;

    p.arquivos.forEach(a =>{
      html += `<div class="file">üìÑ <a href="${a.url}" target="_blank"
              onclick="registrarAcao('ABRIU ARQUIVO','${a.nome}','${a.id}','${p.nome}')">
              ${a.nome}</a></div>`;
    });

    p.subpastas.forEach(sp =>{
      html += `<div class="file" style="margin-left:15px;">üìÇ <strong>${sp.nome}</strong></div>`;

      sp.arquivos.forEach(a2 =>{
        html += `<div class="subfile">üìÑ 
                 <a href="${a2.url}" target="_blank"
                 onclick="registrarAcao('ABRIU ARQUIVO','${a2.nome}','${a2.id}','${sp.nome}')">
                 ${a2.nome}</a></div>`;
      });
    });

    html += "<hr>";
  });

  document.getElementById("conteudoDocs").innerHTML = html;
}

function fecharModal(){
  document.getElementById("modalDocs").style.display = "none";
}
</script>

</body>
</html>
